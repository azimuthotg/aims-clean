<?xml version="1.0" encoding="UTF-8"?>
<!--
    AIMS Project — IIS web.config (Path-based Routing rules)
    วางที่: C:\iis_root\web.config
    หมายเหตุ: ไฟล์นี้เป็นเฉพาะส่วน AIMS ให้นำไปรวมกับ rules ของ project_tracker
              ที่มีอยู่แล้ว อย่า overwrite ทับทั้งไฟล์!

    URL: https://lib.npu.ac.th/aims/
    Waitress: http://127.0.0.1:8001/
-->
<configuration>
    <system.webServer>

        <rewrite>
            <rules>

                <!-- ================================================
                     PROJECT TRACKER (port 8000) — อย่าแตะ
                     เพิ่มเฉพาะ rules ของ AIMS ด้านล่างนี้
                ================================================ -->

                <!-- AIMS: Static files — ให้ IIS serve โดยตรง ไม่ผ่าน Waitress -->
                <rule name="AIMS Static Files" stopProcessing="true">
                    <match url="^aims/static/(.*)" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" />
                    </conditions>
                    <action type="None" />
                </rule>

                <!-- AIMS: App — Reverse Proxy ไป Waitress port 8001 -->
                <rule name="AIMS App" stopProcessing="true">
                    <match url="^aims/(.*)" />
                    <action type="Rewrite" url="http://127.0.0.1:8001/{R:1}" />
                    <serverVariables>
                        <set name="HTTP_X_FORWARDED_PROTO" value="https" />
                        <set name="HTTP_X_FORWARDED_HOST" value="{HTTP_HOST}" />
                    </serverVariables>
                </rule>

            </rules>
        </rewrite>

    </system.webServer>
</configuration>
