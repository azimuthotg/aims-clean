{% extends 'base.html' %}
{% load humanize %}

{% block title %}{{ department_name }} - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô{% endblock %}

{% block content %}
    
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-8">
                    <h1 class="m-0">{{ department_name }}</h1>
                    <p class="text-muted">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</p>
                </div>
                <div class="col-sm-4">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="/executive/">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'dashboard:staff' %}">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</a></li>
                        <li class="breadcrumb-item active">{{ department_name }}</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Statistics -->
    <div class="row mb-4">
        <div class="col-lg-4 col-md-6">
            <div class="small-box bg-gradient-primary">
                <div class="inner">
                    <h3>{{ total_staff|intcomma }}</h3>
                    <p>‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                <div class="icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="small-box-footer">‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ <i class="fas fa-check-circle"></i></div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6">
            <div class="small-box bg-gradient-success">
                <div class="inner">
                    <h3>{{ position_distribution|length }}</h3>
                    <p>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á</p>
                </div>
                <div class="icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="small-box-footer">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ <i class="fas fa-chart-pie"></i></div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6">
            <div class="small-box bg-gradient-info">
                <div class="inner">
                    <h3>{{ employment_type_distribution|length }}</h3>
                    <p>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á</p>
                </div>
                <div class="icon">
                    <i class="fas fa-handshake"></i>
                </div>
                <div class="small-box-footer">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ <i class="fas fa-chart-pie"></i></div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <!-- Row 1: Gender and Employment Type (6md each) -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-pie me-2"></i>
                        ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®
                    </h5>
                </div>
                <div class="card-body">
                    <div id="genderChart" style="height: 300px;"></div>
                    
                    <!-- Gender Summary -->
                    <div class="mt-3">
                        <h6>‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®:</h6>
                        {% for gender in gender_distribution %}
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>{{ gender.GENDERNAMETH|default:"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</span>
                            <span class="badge bg-info">{{ gender.count|intcomma }} ‡∏Ñ‡∏ô ({% widthratio gender.count total_staff 100 %}%)</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-donut me-2"></i>
                        ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á
                    </h5>
                </div>
                <div class="card-body">
                    <div id="employmentTypeChart" style="height: 300px;"></div>
                    
                    <!-- Employment Type Summary -->
                    <div class="mt-3">
                        <h6>‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á:</h6>
                        {% for emp in employment_type_distribution %}
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>{{ emp.STFTYPENAME|default:"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</span>
                            <span class="badge bg-warning text-dark">{{ emp.count|intcomma }} ‡∏Ñ‡∏ô ({% widthratio emp.count total_staff 100 %}%)</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Row 2: All Positions Chart (12md) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-bar me-2"></i>
                        ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({{ position_distribution|length }} ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
                    </h5>
                    <a href="{% url 'dashboard:export_department_excel' department_name %}" class="btn btn-light btn-sm">
                        <i class="fas fa-file-excel me-1"></i> Export Excel
                    </a>
                </div>
                <div class="card-body">
                    <div id="positionChart" style="height: 400px;"></div>
                    
                    <!-- All Positions Summary Table -->
                    <div class="mt-4">
                        <h6>‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-striped">
                                <thead class="table-success">
                                    <tr>
                                        <th width="8%">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                        <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</th>
                                        <th class="text-end" width="15%">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                        <th class="text-center" width="15%">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for pos in position_distribution %}
                                    <tr>
                                        <td class="text-center">
                                            <span class="badge bg-success">{{ forloop.counter }}</span>
                                        </td>
                                        <td>{{ pos.POSNAMETH|default:"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</td>
                                        <td class="text-end">
                                            <span class="fw-bold">{{ pos.count|intcomma }}</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="text-success fw-bold">{% widthratio pos.count total_staff 100 %}%</span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff List Table -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list me-2"></i>
                        ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({{ total_staff }} ‡∏Ñ‡∏ô)
                    </h5>
                    <a href="{% url 'dashboard:export_department_excel' department_name %}" class="btn btn-light btn-sm">
                        <i class="fas fa-file-excel me-1"></i> Export Excel
                    </a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th width="8%">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                    <th width="25%">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th width="10%">‡πÄ‡∏û‡∏®</th>
                                    <th width="35%">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                    <th width="22%">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for staff in staff_list %}
                                <tr>
                                    <td class="text-center">
                                        <span class="badge bg-primary">{{ forloop.counter }}</span>
                                    </td>
                                    <td>
                                        {{ staff.PREFIXFULLNAME|default:"" }} {{ staff.STAFFNAME|default:"" }} {{ staff.STAFFSURNAME|default:"" }}
                                    </td>
                                    <td class="text-center">
                                        {% if staff.GENDERNAMETH == '‡∏ä‡∏≤‡∏¢' %}
                                            <span class="badge bg-info">{{ staff.GENDERNAMETH }}</span>
                                        {% elif staff.GENDERNAMETH == '‡∏´‡∏ç‡∏¥‡∏á' %}
                                            <span class="badge bg-warning">{{ staff.GENDERNAMETH }}</span>
                                        {% else %}
                                            <span class="badge bg-secondary">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small>{{ staff.POSNAMETH|default:"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</small>
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ staff.STFTYPENAME|default:"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü
    const genderLabels = {{ gender_labels|safe }};
    const genderData = {{ gender_data|safe }};
    const positionLabels = {{ position_labels|safe }};
    const positionData = {{ position_data|safe }};
    const employmentTypeLabels = {{ employment_type_labels|safe }};
    const employmentTypeData = {{ employment_type_data|safe }};
    
    // ‡∏Å‡∏£‡∏≤‡∏ü‡πÇ‡∏î‡∏ô‡∏±‡∏ó - ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®
    if (genderLabels.length > 0) {
        const genderOptions = {
            series: genderData,
            chart: {
                type: 'donut',
                height: 250,
                toolbar: { show: false }
            },
            labels: genderLabels,
            plotOptions: {
                pie: {
                    donut: {
                        size: '60%',
                        labels: {
                            show: true,
                            total: {
                                show: true,
                                label: '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                                formatter: function (w) {
                                    const total = w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                    return total.toLocaleString();
                                }
                            }
                        }
                    }
                }
            },
            dataLabels: {
                enabled: true,
                formatter: function (val, opts) {
                    const value = opts.w.config.series[opts.seriesIndex];
                    return value.toLocaleString();
                }
            },
            tooltip: {
                y: {
                    formatter: function(val) {
                        return val.toLocaleString() + ' ‡∏Ñ‡∏ô';
                    }
                }
            },
            legend: {
                position: 'bottom',
                fontSize: '14px'
            },
            colors: ['#2563eb', '#dc2626', '#d97706']
        };
        
        const genderChart = new ApexCharts(document.querySelector("#genderChart"), genderOptions);
        genderChart.render();
    }
    
    // ‡∏Å‡∏£‡∏≤‡∏ü‡πÇ‡∏î‡∏ô‡∏±‡∏ó - ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á
    if (employmentTypeLabels.length > 0) {
        const employmentTypeOptions = {
            series: employmentTypeData,
            chart: {
                type: 'donut',
                height: 250,
                toolbar: { show: false }
            },
            labels: employmentTypeLabels,
            plotOptions: {
                pie: {
                    donut: {
                        size: '60%',
                        labels: {
                            show: true,
                            total: {
                                show: true,
                                label: '‡∏£‡∏ß‡∏°',
                                formatter: function (w) {
                                    const total = w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                    return total.toLocaleString();
                                }
                            }
                        }
                    }
                }
            },
            dataLabels: {
                enabled: true,
                formatter: function (val, opts) {
                    const value = opts.w.config.series[opts.seriesIndex];
                    return value.toLocaleString();
                }
            },
            tooltip: {
                y: {
                    formatter: function(val) {
                        return val.toLocaleString() + ' ‡∏Ñ‡∏ô';
                    }
                }
            },
            legend: {
                position: 'bottom',
                fontSize: '12px'
            },
            colors: ['#f59e0b', '#10b981', '#ef4444', '#8b5cf6', '#06b6d4', '#84cc16']
        };
        
        const employmentTypeChart = new ApexCharts(document.querySelector("#employmentTypeChart"), employmentTypeOptions);
        employmentTypeChart.render();
    }
    
    // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    if (positionLabels.length > 0) {
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏ö‡∏ö Dynamic ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
        const baseHeight = 300;                    // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
        const heightPerItem = 28;                  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á 1 ‡∏ï‡∏±‡∏ß
        const minHeight = 350;                     // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î
        const maxHeight = 900;                     // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
        const dynamicHeight = Math.min(maxHeight, Math.max(minHeight, positionLabels.length * heightPerItem + baseHeight));
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà Y-axis ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        let yAxisWidth = '35%';  // default
        if (positionLabels.length <= 8) {
            yAxisWidth = '30%';      // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡πá‡∏Å
        } else if (positionLabels.length <= 15) {
            yAxisWidth = '35%';      // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á  
        } else {
            yAxisWidth = '40%';      // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà
        }
        
        console.log(`üìä Dynamic Chart: ${positionLabels.length} positions, height: ${dynamicHeight}px, yAxis: ${yAxisWidth}`);
        
        const positionOptions = {
            series: [{
                name: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô',
                data: positionData
            }],
            chart: {
                type: 'bar',
                height: dynamicHeight,
                toolbar: {
                    show: false
                }
            },
            plotOptions: {
                bar: {
                    borderRadius: 6,
                    horizontal: true,
                    distributed: true,
                    barHeight: positionLabels.length <= 8 ? '65%' : positionLabels.length <= 15 ? '75%' : '85%'
                }
            },
            dataLabels: {
                enabled: true,
                style: {
                    colors: ['#fff'],
                    fontSize: positionLabels.length <= 8 ? '13px' : positionLabels.length <= 15 ? '12px' : '11px',
                    fontWeight: 'bold'
                },
                formatter: function(val) {
                    return val.toLocaleString() + ' ‡∏Ñ‡∏ô';
                }
            },
            xaxis: {
                categories: positionLabels,
                title: {
                    text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£ (‡∏Ñ‡∏ô)',
                    style: {
                        fontSize: '14px',
                        fontWeight: '600'
                    }
                },
                labels: {
                    style: {
                        fontSize: positionLabels.length <= 8 ? '12px' : '11px'
                    },
                    formatter: function(val) {
                        return val.toLocaleString();
                    },
                    maxWidth: positionLabels.length <= 8 ? 120 : positionLabels.length <= 15 ? 100 : 80
                }
            },
            yaxis: {
                title: {
                    text: '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô',
                    style: {
                        fontSize: '14px',
                        fontWeight: '600'
                    }
                },
                labels: {
                    style: {
                        fontSize: positionLabels.length <= 8 ? '14px' : positionLabels.length <= 15 ? '13px' : '12px',
                        fontWeight: '500'
                    },
                    maxWidth: positionLabels.length <= 8 ? 180 : positionLabels.length <= 15 ? 200 : 220,
                    formatter: function(val) {
                        // ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ - ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                        let maxLength = 35;
                        if (positionLabels.length <= 8) {
                            maxLength = 40;    // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡πá‡∏Å - ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ß‡∏Å‡∏ß‡πà‡∏≤
                        } else if (positionLabels.length <= 15) {
                            maxLength = 35;    // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
                        } else {
                            maxLength = 30;    // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà - ‡∏ï‡∏±‡∏î‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á
                        }
                        
                        if (val.length > maxLength) {
                            return val.substring(0, maxLength - 3) + '...';
                        }
                        return val;
                    }
                }
            },
            grid: {
                show: true,
                borderColor: '#e0e6ed',
                strokeDashArray: 5,
                xaxis: {
                    lines: {
                        show: true
                    }
                },
                yaxis: {
                    lines: {
                        show: false
                    }
                }
            },
            tooltip: {
                y: {
                    formatter: function(val) {
                        return val.toLocaleString() + ' ‡∏Ñ‡∏ô';
                    }
                },
                x: {
                    formatter: function(val) {
                        return val; // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏ï‡πá‡∏°
                    }
                }
            },
            title: {
                text: '‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô',
                align: 'center',
                style: {
                    fontSize: '16px',
                    fontWeight: 'bold',
                    color: '#059669'
                }
            },
            colors: ['#059669'],
            responsive: [{
                breakpoint: 1024,
                options: {
                    chart: {
                        height: Math.max(300, dynamicHeight * 0.8)  // ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ö‡∏ô tablet
                    },
                    yaxis: {
                        labels: {
                            style: {
                                fontSize: '12px'
                            },
                            maxWidth: 160
                        }
                    }
                }
            }, {
                breakpoint: 768,
                options: {
                    chart: {
                        height: Math.max(250, dynamicHeight * 0.6)  // ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
                    },
                    yaxis: {
                        labels: {
                            style: {
                                fontSize: '11px'
                            },
                            maxWidth: 130,
                            formatter: function(val) {
                                // ‡∏ï‡∏±‡∏î‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
                                if (val.length > 20) {
                                    return val.substring(0, 17) + '...';
                                }
                                return val;
                            }
                        }
                    },
                    xaxis: {
                        labels: {
                            style: {
                                fontSize: '10px'
                            }
                        }
                    }
                }
            }]
        };
        
        const positionChart = new ApexCharts(document.querySelector("#positionChart"), positionOptions);
        positionChart.render();
    }
    
    console.log('‚úÖ Department Detail Dashboard loaded successfully for: {{ department_name }}');
});
</script>
{% endblock %}